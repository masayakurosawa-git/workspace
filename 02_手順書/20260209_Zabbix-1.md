# Zabbix7.0 を AmazonLinux2023 にインストールする
※ コマンドはすべて root ユーザーで実行します。

## 目次
### Zabbixを構築する
### 監視用のEC2に ZabbixAgent を構築する



## システム構成
- Zabbix Server: 7.0.4
- Zabbix Agent: 7.0.4
- OS: Amazon Linux 2023.5.20241001
- Web サーバ: Apache/2.4.62
- PHP: PHP 8.3.10
- DB: MariaDB 10.5.25

- 必要なセキュリティグループ：
    - SSH (22/TCP)
    - HTTP (80/TCP)
    - 10050/TCP (Zabbix Agent)
    - 10051/TCP (Zabbix Server)

</br>
</br>


## タイムゾーン変更
EC2接続
```bash
ssh -i ~/.ssh/CL_kurosawa_key.pem ec2-user@34.221.226.198
```

root権限に変更
```bash
sudo su -
```

タイムゾーンを日本に変更
```bash
timedatectl set-timezone Asia/Tokyo

# 確認
date
-----------------------------------
[root@ip-172-31-29-119 ~]# date
Mon Feb  9 11:03:51 JST 2026
[root@ip-172-31-29-119 ~]# 
-----------------------------------
```

</br>
</br>


## 1. MariaDB のインストール
MariaDB をインストール
```bash
dnf install mariadb105-server -y
```

確認：
```bash
mariadb --version
```

MariaDB 起動
```bash
systemctl enable mariadb
systemctl start mariadb
systemctl status mariadb
```

セキュリティ設定
```bash
# root パスワードを設定します。
mysql_secure_installation

kurosawa
で設定
```

</br>
</br>


## 2. Zabbix のインストール
Zabbix リポジトリの登録
```bash
rpm -Uvh https://repo.zabbix.com/zabbix/7.0/amazonlinux/2023/x86_64/zabbix-release-7.0-6.amzn2023.noarch.rpm
dnf clean all
```

Zabbix パッケージをインストール
```bash
dnf install zabbix-server-mysql zabbix-web-mysql zabbix-apache-conf zabbix-sql-scripts -y
dnf install zabbix-agent -y
dnf install zabbix-web-japanese -y
```

</br>
</br>


## 3. Zabbix 用データベースの作成
DB とユーザー作成
```bash
mysql -uroot -p

create database zabbix character set utf8mb4 collate utf8mb4_bin;
create user zabbix@localhost identified by 'zabbix';
grant all privileges on zabbix.* to zabbix@localhost;

# DB作成確認
show databases;

# ユーザ作成確認
select user, host from mysql.user;
```

一時的に以下を設定：
```bash
set global log_bin_trust_function_creators = 1;
quit;
```

スキーマとデータのインポート
```bash
zcat /usr/share/zabbix-sql-scripts/mysql/server.sql.gz | mysql --default-character-set=utf8mb4 -uzabbix -p zabbix

quit;
```

終了後は log_bin_trust_function_creators を元に戻します。
```bash
mysql -uroot -p

# 戻し
set global log_bin_trust_function_creators = 0;

# ユーザ作成確認
select user, host from mysql.user;

quit;
```

</br>
</br>


## 4. Zabbix Server の起動
Zabbix 設定
```bash
# 編集
cp -a /etc/zabbix/zabbix_server.conf{,.org}
vi /etc/zabbix/zabbix_server.conf
-----------------------------------
# DBPassword=<Zabbix 用 DB パスワード>
DBPassword=zabbix
DBHost=localhost
DBName=zabbix
DBUser=zabbix
-----------------------------------
```

ZabbixAgent 設定
```bash
cp -a /etc/zabbix/zabbix_agentd.conf{,.org}
vi /etc/zabbix/zabbix_agentd.conf
-----------------------------------
Server=127.0.0.1
ServerActive=127.0.0.1
Hostname=Zabbix server
-----------------------------------

# 起動
systemctl start zabbix-agent
```


サービス起動
```bash
systemctl start zabbix-server httpd php-fpm
systemctl enable zabbix-server httpd php-fpm
#起動確認：
systemctl status zabbix-server
```

</br>
</br>


## 5. Zabbix Web の初期設定

ブラウザで以下を開きます：
```bash
# http://<EC2 インスタンスの IP>/zabbix/
http://34.221.226.198/zabbix/
```

```
画面に沿って進めていきます：

  - 言語選択（Japanese など）
  - 前提条件チェック
  - データベース設定（DB 名、ユーザー、パスワード）
  - Zabbix サーバー情報（名前、タイムゾーン）
  - インストール実行

完了すればログイン画面が表示されます。
```

</br>
</br>


## 6. ログイン
```
初期ユーザー情報：

ユーザー: Admin
パスワード: zabbix

必要に応じてログイン後に初期パスワードを変更します（ユーザー設定 → プロファイル → パスワード変更）。
```

</br>
</br>


## 7. Zabbix Agent の起動
```bash
systemctl start zabbix-agent
systemctl enable zabbix-agent
systemctl status zabbix-agent

# Web UI の「監視データ → ホスト」で Agent の状態を確認できます。
```

