# 手順
### 1. EC2インスタンスに接続
```bash
ssh -i ~/.ssh/CL_kurosawa.pem ec2-user@54.191.25.63
```
<br/>

### 2. BIND のインストール
```bash
sudo dnf install bind
```
<br/>

### 3. BIND の起動
```bash
# 状態確認
sudo systemctl status named

# 起動
sudo systemctl start named

# 状態確認
sudo systemctl status named

# プロセス確認
sudo ps -ef | grep named

# 53番ポート確認
sudo netstat -ln | grep 53
```
<br/>

### 4. named 設定ファイルの変更
```diff
# バックアップ作成
sudo cp -a /etc/named.conf{,.bk}
# ファイル作成
sudo vi /etc/named.conf

----------------------------------------
# リッスンポートをコメント
- listen-on port 53 { 127.0.0.1; };
- listen-on-v6 port 53 { ::1; };
+ # listen-on port 53 { 127.0.0.1; };
+ # listen-on-v6 port 53 { ::1; };


#全てのサーバからのクエリの受付を許可する。
- allow-query     { localhost; };
+ allow-query     { any; };
----------------------------------------
```
<br/>

### 5. named.conf のチェック
```bash
# 何も表示されなければOK
sudo named-checkconf

# 再起動
sudo systemctl restart named

# 状態確認
sudo systemctl status named

# 53番ポート確認
sudo netstat -ln | grep 53
```
<br/>

### 6. ゾーンデータベースファイルの読み込み設定  
ゾーン名: hogehoge.com  
ファイルパス: /var/named/hogehoge.com.zone  

```bash
sudo vi /etc/named.conf

----------------------------------------
# 末尾に追加。
zone "hogehoge.com" IN {
    type master;
    file "/var/named/hogehoge.com.zone";
};
----------------------------------------
```
<br/>

### 7. 設定ファイルの構文チェック
```bash
sudo named-checkconf
```
<br/>

### 8. ゾーンデータベースファイルの作成
```bash
sudo vi /var/named/hogehoge.com.zone

----------------------------------------
$TTL 3600
@ IN SOA ns.hogehoge.com. test.gmail.com. (
20220401 ; serial
3600 ; refresh
3600 ; retry
3600 ; expire
3600 ) ; minimum

        IN NS ns.hogehoge.com.
ns      IN A  172.31.16.240
www     IN A  172.31.16.240
----------------------------------------
```
```bash
$TTL 3600: 3600秒キャッシュを保持
SOA: SOAレコード
NS: 管理しているDNSサーバを指定するレコード
A: ホスト名に対するIPアドレスを指定するレコード

空欄には、「hogehoge.com」が保管されている。
変更が終わったら、serialの数値を進めること。
TTLの時間を変えないと前の設定を保持してしまうため、値を小さくする。
```
<br/>

### 9. ゾーンデータベースファイルの構文チェック
```bash
sudo named-checkzone hogehoge.com /var/named/hogehoge.com.zone
```
<br/>

### 10. namedを再起動
```bash
sudo systemctl restart named
```
<br/>

### 11. ゾーンの確認
```
dig @localhost www.hogehoge.com

#文法
dig {自分} {検索したいドメイン}

# 以下が返ってくることを確認する。
# ANSWER: 1
# 自分のIP
```
<br/>

