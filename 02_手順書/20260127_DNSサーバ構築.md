# DNSサーバの設定

### DNSサーバのインストール
```bash
dnf systemctl install bind
```
</br>


### DNSサーバ設定変更
```bash
##バックアップの作成
cp -a /etc/named.conf /etc/named.conf.bak

##設定ファイルの修正
vi /etc/named.conf
-------------------------------------
// listen-on port53{127.0.0.1;};
// listen-on-v6 port53{::1;};

// allow-query { local-host; };
   allow-query{ any; };

zone "teamc.entrycl.net" IN {
    type master;
    file "/var/named/hogehoge.com.zone";
};
-------------------------------------

#設定ファイルのチェック
named-checkconf
```
</br>


### ゾーンデータベースファイル新規作成
```bash
#ゾーンデータベースファイル新規作成
vi /var/named/hogehoge.com.zone
-------------------------------------
$TTL 30
@ IN SOA ns.teamc.entrycl.net. test.gmail.com (
20260127 ; serial
3600 ; refresh
3600 ; retry
3600 ; expire
3600 ) ; minimum

 IN NS ns.teamc.entrycl.net.
; MX

@   IN MX 10 mail1.teamc.entrycl.net.
@   IN MX 20 mail2.teamc.entrycl.net.
@   IN MX 30 mail3.teamc.entrycl.net.
@   IN MX 40 mail4.teamc.entrycl.net.

ns     IN A 172.31.16.157 (DNSサーバーのプライベートIPアドレス)
mail1  IN A 18.246.237.98 (各EC2のプライベートIPアドレス)
mail2  IN A 35.95.34.55
mail3  IN A 35.86.84.119
mail4  IN A 34.217.33.80
-------------------------------------

#ゾーンファイルの設定確認
named-checkzone hogehoge.com /var/named/hogehoge.com.zone

#bind再起動
systemctl restart named

#DNSへの連携確認
dig mail1.teamc.entrycl.net
```
</br>


### resolved.conf の確認
```bash
#設定ファイルの確認
cp -a /etc/systemd/resolved.conf /etc/systemd/resolved.conf.bak
vi /etc/systemd/resolved.conf
-------------------------------------
DNS=DNSサーバのプライベートIPアドレス
↑DNS前のコメントアウトを削除
-------------------------------------

#再起動
systemctl restart systemd-resolved.service
```
