# 監視用のEC2に ZabbixAgent を構築する

## システム構成
- Zabbix Server: 7.0.4
- Zabbix Agent: 7.0.4
- OS: Amazon Linux 2023.5.20241001
- Web サーバ: Apache/2.4.62
- PHP: PHP 8.3.10
- DB: MariaDB 10.5.25

- 必要なセキュリティグループ：
    - SSH (22/TCP)
    - HTTP (80/TCP)
    - 10050/TCP (Zabbix Agent)
    - 10051/TCP (Zabbix Server)

</br>
</br>

## 1. Zabbix のインストール
EC2接続
```bash
ssh -i ~/.ssh/CL_kurosawa_key.pem ec2-user@54.213.10.15
```


root権限に変更
```bash
sudo su -
```


Zabbix リポジトリの登録
```bash
rpm -Uvh https://repo.zabbix.com/zabbix/7.0/amazonlinux/2023/x86_64/zabbix-release-7.0-6.amzn2023.noarch.rpm
dnf clean all
```


zabbix-agent をインストール
```bash
dnf install zabbix-agent zabbix-get -y
```


ZabbixAgent 設定
```bash
cp -a /etc/zabbix/zabbix_agentd.conf{,_`date +"%Y%m%d_%H%M%S"`.org}
vi /etc/zabbix/zabbix_agentd.conf
-----------------------------------
# Server=ZabbixServerのIP
Server=172.31.29.119
# ServerActive=ZabbixServerのIP
ServerActive=172.31.29.119
# Hostname=監視対象の名前(わかりやすいもの)
Hostname=zabbix agent
-----------------------------------
```


起動
```bash
systemctl start zabbix-agent
systemctl enable zabbix-agent
```
</br>
</br>


## 2. セキュリティグループルール追加
```bash
# エージェント側
------------------------------------
Type: TCP
Port: 10051
Protocol: TCP
Source: ZabbixサーバのSG
------------------------------------

# サーバ側
------------------------------------
Type: TCP
Port: 10050
Protocol: TCP
Source: vpcのネットワークアドレス
------------------------------------

```






