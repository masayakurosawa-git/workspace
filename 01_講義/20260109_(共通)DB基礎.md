# DB基礎
RDBMS：リレーショナルデータベースシステム
例）mysql, Oracle, PostgreSQL

# SQL
行：レコード
列：カラム
表：テーブル

主キー：行を一意に特定するもの

SELECT：検索
INSERT：登録
UPDATE：更新
DELETE：削除

CREATE TABLE：テーブル作成
DROP TABLE：テーブル削除

# トランザクション
BEGIN：トランザクション開始
COMMIT：コミット
ROLLBACK：トランザクションを開始時まで戻す

# 演習１
create table employees (
	id integer primary key,
	name text not null,
	age integer,
	gender text,
	department_id integer
);

create table departments (
	id integer primary key,
	name text not null
);



# 演習２
- 登録
insert into employees 
(id, name, age, gender, department_id) VALUES 
(1, '伊賀将之', 38, '男性', 3),
(2, '山田花子', 52, '女性', 1),
(3, '鈴木一朗', 23, '男性', 2),
(4, '鈴木一子', 44, '女性', 1),
(5, '佐藤次郎', 18, '男性', 3)
;

insert into departments 
(id, name) VALUES 
(1, '開発部'),
(2, '営業部'),
(3, '管理部')
;

- 確認
select * from departments;
select * from employees;


# 演習３
- employeesテーブルから全員の全フィールドを抽出
select * from employees;

- employeesテーブルから25歳以上の人の名前と年齢だけを抽出
select name, age from employees where age >= 25;

- employeesテーブルから全員の全フィールドを年齢で昇順にソートして抽出
select * from employees order by age;

- employeesテーブルから25歳以上の男性だけを全フィールド抽出
select * from employees where age >= 25 and gender = '男性';


# 演習４
- employeesテーブルのidが5の人の名前を「坂本龍馬」に、年齢を「31」歳に更新する
begin;
update employees
set name = '坂本龍馬', age = 31
where id = 5;
select * from employees where id = 5;
commit;

- employeesテーブルの全員の年齢に1を加える
begin;
select * from employees;
update employees set age = age + 1;
select * from employees;
commit;

- employeesテーブルのdepartment_idが1のデータを削除する
begin;
select * from employees;
delete from employees where department_id = 1;
select * from employees;
commit;



# 内部結合
SELECT
 e.id "従業員ID",
 e.name "従業員名",
 d.id "部署ID",
 d.name "部署名"
FROM employees e
JOIN departments d ON e.department_id = d.id;

※inner join = join



# 外部結合
SELECT
 e.id "従業員ID",
 e.name "従業員名",
 d.id "部署ID",
 d.name "部署名"
FROM employees e
LEFT OUTER JOIN departments d ON e.department_id = d.id;

※LEFT OUTER JOIN = LEFT JOIN



# 文字列の曖昧検索
% 任意の長さの任意の文字から構成される文字列を表します（０文字でも可）。
_ 一文字の任意文字を表します。



# 演習５
- 問題１
CREATE TABLE members (
 id serial PRIMARY KEY,
 name varchar(20) NOT NULL,
 email varchar(20) NOT NULL UNIQUE,
 gender integerNOT NULL,
 birth_date date NOT NULL,
 aged integer NOT NULL,
 period_id integer NOT NULL,
 deleted boolean DEFAULT false
);

COMMENT ON COLUMN members.id IS '自動採番';
COMMENT ON COLUMN members.name IS '名前';
COMMENT ON COLUMN members.email IS 'メールアドレス';
COMMENT ON COLUMN members.gender IS '性別(男:1,女:2)';
COMMENT ON COLUMN members.birth_date IS '誕生日';
COMMENT ON COLUMN members.aged IS '享年';
COMMENT ON COLUMN members.period_id IS '時代ID';
COMMENT ON COLUMN members.deleted IS '削除フラグ(デフォルト値:false)';


- 問題２
insert into members 
(name, email, gender, birth_date, aged, period_id, deleted) VALUES 
('聖徳太子', 'taishi@example.com', 1, '574-02-7', 48, 2, true)
('武田信玄', 'takeda@example.com', 1, '1521-12-1', 51, 6, false)
('坂本龍馬', 'ryoma@example.com', 1, '1836-1-3', 31, 8, true)
('推古天皇', 'suiko@example.com', 2, '554-1-1', 74, 2, false)
('織田信長', 'oda@example.com', 1, '1534-6-23', 47, 6, false)
('樋口一葉', 'ichiyo@example.com', 2, '1872-3-25', 24, 9, false)
;


- 問題３
select * from members where deleted = false and gender = 2 order by id;
select * from members where deleted = false and EXTRACT(YEAR FROM birth_date) < 1000 order by id;
select * from members where deleted = false and name like '%信%' order by id;
select period_id, max(aged) max_aged, avg(aged) avg_aged, min(aged) min_aged from members group by period_id order by period_id;


- 問題４
select * from members;
begin;
update members set name = '山田一葉' where name = '樋口一葉';
update members set deleted = true where name = '武田信玄';
commit;


- 問題５
CREATE TABLE periods (
 id serial PRIMARY KEY,
 name varchar(10) NOT NULL
);
COMMENT ON COLUMN periods.id IS '時代ID';
COMMENT ON COLUMN periods.name IS '時代名';

insert into periods values
(1,'古代'),
(2,'飛鳥時代'),
(3,'奈良時代'),
(4,'平安時代'),
(5,'鎌倉時代'),
(6,'室町時代'),
(7,'安土桃山時代'),
(8,'江戸時代'),
(9,'明治時代'),
(10,'大正時代'),
(11,'昭和時代'),
(12,'平成時代')
;


select * from periods;


- 問題６
select m.name 人物名, p.name 時代名
from members m
join periods p on m.period_id = p.id
order by p.id;

