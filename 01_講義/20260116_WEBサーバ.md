# テスト
- 間違えた問題
=====================================================================
12. ユーザを作成するコマンドは何か
グループ名：rkg UID：801 プライマリグループ：rakus-g セカンダリグループ：rkg

a. createuser
b. adduser
c. useradd
d. usemod
e. usradd
f. userown
=====================================================================


- 正解
c. useradd


- 解説
useradd と adduser は新規ユーザを追加するコマンドだが、一部違いがある。
違いは以下である。
=====================================================================
## useradd 
この例では、-m を付けてようやくホームディレクトリが作られ、-s でログインシェルを指定しています。
こうしたオプションを一つひとつ指定して、足りない部分を自分で補うやり方です。
ex) sudo useradd -m -s /bin/bash user

## adduser 
この一行で、ホームディレクトリの作成からパスワード設定、.bashrc のコピー、グループ作成まで一通りやってくれます。
ex) sudo adduser user
=====================================================================
今回の問では、ユーザに対する設定が指定されているため、useraddを使用してユーザを作成することが正しい。


- 参考
https://note.com/minato_kame/n/ne879fac8a444




ミドルウェアを入れることにより、役割を持たせることができる。


# webサイトを閲覧するためのプロセス

1. ブラウザにURLの入力
http://www.rakus-partners.co.jp/index.html
============================================
## スキーム名: http
プロトコル指定。

## ホスト名: www.rakus-partners.co.jp
アクセスするサーバを指定。

## パス名: /index.html
サーバ上のリソースを指定。
============================================


2. DNSサーバに問い合わせ
ドメインがどのIPアドレスかを判別するため。
IPアドレスが判明するとwebサイトの住所がわかるようになる。



# webシステムにおけるサーバごとの役割

- web三層構造
以下サーバのまとまり。
webサーバ
APサーバ
DBサーバ


webサーバがリクエストをAPサーバに通信を流す
↓
APサーバで動いているアプリケーションは、リクエスト内容に応じてDBサーバにデータをリクエストする。
↓
DBサーバは、APサーバからのリクエストに応じて、データをAPサーバに返し、APサーバでアプリケーションを処理する。
↓
処理後、APサーバはWEBサーバに対しレスポンスを返し、WEBサーバはページを表示する。





# Web Server
## www 概要


## レスポンスとは
- ステータスコード 
1xx     Infomation      リクエストが受理されている情報。
2xx     Successful      リクエストが正常動作。
3xx     Redirection     リクエストを完了するには、さらに処理が必要。
4xx     Client Error    クライアント側で入力ミスがある可能性。
5xx     Server Error    サーバでエラーが発生している。


- 代表例
200     OK                      webサーバが正常
401     UNAUTHORIZED            ユーザ認証に失敗
403     FORBIDDEN               権限不足
404     NOT FOUND               ファイルが存在しない
500     INTERNAL SERVER ERROR   サーバでエラーが発生している


- ステータスコード確認
curl -LI http://example.com/
============================================================================
[kurosawamasaya@kurosawamasayanoMacBook-Pro ~]$ curl -LI http://example.com/
HTTP/1.1 200 OK
Date: Fri, 16 Jan 2026 01:56:54 GMT
Content-Type: text/html
Connection: keep-alive
CF-RAY: 9be9ffc099a71b46-NRT
Last-Modified: Tue, 13 Jan 2026 19:10:53 GMT
Allow: GET, HEAD
Accept-Ranges: bytes
Age: 7492
cf-cache-status: HIT
Server: cloudflare

[kurosawamasaya@kurosawamasayanoMacBook-Pro ~]$ 
============================================================================



## Apache とは
オープンソースのwebサーバ。
Apache か Ngix が主流。

- アクセスログ
/var/log/httpd/access_log

- エラーログ
/var/log/httpd/error_log

- 設定ファイル
/etc/httpd/conf/httpd.comf
※ 設定変更の際には、Apacheを再起動する必要あり。
=========================================
systemctl start httpd（Apache起動）
systemctl restart httpd（Apache再起動）
systemctl stop httpd（Apache停止）
systemctl enable httpd（Apache可能）
=========================================

- ディレクティブ
各種設定は、ディレクティブという単位で行う。
=========================================
<Directory "/var/www/html">
    Options Indexes
    AllowOverride None
</Directory>
=========================================

- ドキュメントルート
webサーバで静的コンテンツを格納するトップディレクトリのことを指す。
=========================================
DocumentRoot ディレクトリパス
=========================================



# 演習
## Web-1
=========================================
1. 特権ユーザにスイッチ。
sudo su -

2. ドキュメントルートに /yakiniku を作成。
mkdir /var/www/html/yakiniku

3. ドキュメントルートに /yakiniku/harami.html を作成。
vi /var/www/html/yakiniku/harami.html

4. ブラウザでURLを検索。
http:/44.252.33.32/yakiniku/harami.html
※ IPは自身のグローバルIP
=========================================


## Web-2
=========================================
1. 特権ユーザにスイッチ。
sudo su -

2. httpd.conf のバックアップを作成。
cp -a /etc/httpd/conf/httpd.conf /etc/httpd/conf/httpd.conf.bk
※ cp -a で日付もコピーできる(全く同じものをコピーできる)

3. /home/saba/miso を作成。
mkdir -p /home/saba/miso
※ mkdir -p でディレクトを再帰的に作成。


4. httpd.conf のドキュメントルートを /home/saba に変更。
vi /etc/httpd/conf/httpd.conf
[エディタ内検索]
/
DocumentRoot

[以下に変更]
①
DocumentRoot "/var/www/html"
↓
DocumentRoot "/home/saba"

②
<Directory "/var/www">
↓
<Directory "/home/saba">

③
<Directory "/var/www/html">
↓
<Directory "/home/saba">


5. Apacheの再起動（設定ファイルが反映される）
systemctl restart httpd
systemctl status httpd
※状態確認

6. ドキュメントルートに /miso/hoge.html を作成。
vi /home/saba/miso/hoge.html

7. ブラウザでURLを検索。
http:/44.252.33.32/miso/hoge.html
※ IPは自身のグローバルIP
=========================================


## Web-3
=========================================
1. httpd.conf にリダイレクト設定を追加。
vi /etc/httpd/conf/httpd.conf
[末尾に追加]
Redirect 301 /sa-mon.html http://{BさんのグローバルIP}/aburi-sa-mon.html
※ httpd.conf のバックアップは作成すること。web-2で作成したため今回は割愛。

2. ドキュメントルートに /sa-mon.html を作成。(Aさん作業)
vi /home/saba/sa-mon.html
※ ドキュメントルートは /home/saba であることを前提とする。

3. ドキュメントルートに /aburi-sa-mon.html を作成。(Bさん作業)
vi /home/saba/aburi-sa-mon.html
※ ドキュメントルートは /home/saba であることを前提とする。

4. ブラウザでURLを検索
http:/44.252.33.32/sa-mon.html

5. 以下URLにリダイレクトされていることを確認。
http:/{BさんのグローバルIP}/aburi-sa-mon.html

- 参考
リダイレクトについt
https://tamata78.hatenablog.com/entry/2018/11/20/205222
=========================================


## web-4
=========================================
1. httpd.conf にIP制限の設定を追加。
vi /etc/httpd/conf/httpd.conf
[追加①]
<Directory "/home/saba">
    AllowOverride None
    # Allow open access:
    Require all granted
</Directory>
↓
<Directory "/home/saba">
    AllowOverride None
    # Allow open access:
    # Require all granted
    <RequireAll>
        Require ip 172.31.31.121
        Require not ip 172.31.25.144
    </RequireAll>
</Directory>

[追加②]
# Further relax access to the default document root:
<Directory "/home/saba">
    #
    # Possible values for the Options directive are "None", "All",
    # or any combination of:
    #   Indexes Includes FollowSymLinks SymLinksifOwnerMatch ExecCGI MultiViews
    #
    # Note that "MultiViews" must be named *explicitly* --- "Options All"
    # doesn't give it to you.
    #
    # The Options directive is both complicated and important.  Please see
    # http://httpd.apache.org/docs/2.4/mod/core.html#options
    # for more information.
    #
    Options Indexes FollowSymLinks

    #
    # AllowOverride controls what directives may be placed in .htaccess files.
    # It can be "All", "None", or any combination of the keywords:
    #   AllowOverride FileInfo AuthConfig Limit
    #
    AllowOverride None

    #
    # Controls who can get stuff from this server.
    #
    Require all granted
</Directory>

↓

# Further relax access to the default document root:
<Directory "/home/saba">
    #
    # Possible values for the Options directive are "None", "All",
    # or any combination of:
    #   Indexes Includes FollowSymLinks SymLinksifOwnerMatch ExecCGI MultiViews
    #
    # Note that "MultiViews" must be named *explicitly* --- "Options All"
    # doesn't give it to you.
    #
    # The Options directive is both complicated and important.  Please see
    # http://httpd.apache.org/docs/2.4/mod/core.html#options
    # for more information.
    #
    Options Indexes FollowSymLinks

    #
    # AllowOverride controls what directives may be placed in .htaccess files.
    # It can be "All", "None", or any combination of the keywords:
    #   AllowOverride FileInfo AuthConfig Limit
    #
    AllowOverride None

    #
    # Controls who can get stuff from this server.
    #
    # Require all granted
    <RequireAll>
        Require ip 172.31.31.121
        Require not ip 172.31.25.144
    </RequireAll>
</Directory>


2. 
3. 
4. 
5. 

=========================================



## 注意点
システムファイルを書き換える時は、必ずバックアップを取る。
cp -a /etc/httpd/conf/httpd.comf /etc/httpd/conf/httpd.comf.bk
※ cp -a で日付込でコピーできる。







## EC2接続情報
ssh -i ~/.ssh/CL_kurosawa.pem ec2-user@44.252.33.32






